<div class="d-flex vh-100 justify-content-center align-items-center">
  <div class="card p-0 shadow-lg registration-card-integrated">
    <div class="row g-0 h-100">
      <div class="col-md-2 bg-marrom d-flex flex-column justify-content-end align-items-center p-3 rounded-start">
        <img src="assets/logo-domus.png" alt="Logo Domus" class="img-fluid" style="max-height: 100px;">
      </div>

      <div class="col-md-10 p-4">
        <h3 class="mb-4 text-center text-md-start">Crie sua Conta</h3>

        <form (ngSubmit)="registrar()" #formRegistro="ngForm">
          <div class="row g-2">
            <div class="col-md-6 mb-3">
              <label for="fullName" class="form-label">Nome Completo<span class="required-star">*</span></label>
              <input type="text" class="form-control" id="fullName" name="fullName" [(ngModel)]="registroData.fullName" required #fullName="ngModel"
                     [class.is-invalid]="fullName.invalid && (fullName.dirty || fullName.touched || formRegistro.submitted)">
              <div class="invalid-feedback" *ngIf="fullName.errors?.['required'] && (fullName.dirty || fullName.touched || formRegistro.submitted)">
                Nome completo é obrigatório.
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="email" class="form-label">E-mail<span class="required-star">*</span></label>
              <input type="email" class="form-control" id="email" name="email" [(ngModel)]="registroData.email" placeholder="seu@email.com" required #email="ngModel"
                     [class.is-invalid]="email.invalid && (email.dirty || email.touched || formRegistro.submitted)">
              <div class="invalid-feedback" *ngIf="email.errors?.['required'] && (email.dirty || email.touched || formRegistro.submitted)">
                E-mail é obrigatório.
              </div>
              <div class="invalid-feedback" *ngIf="email.errors?.['email'] && (email.dirty || email.touched || formRegistro.submitted)">
                **E-mail inválido**.
              </div>
            </div>
          </div>

          <div class="row g-2">
            <div class="col-md-6 mb-3">
              <label for="phone" class="form-label">Telefone<span class="required-star">*</span></label>
              <input type="tel" class="form-control" id="phone" name="phone" [(ngModel)]="registroData.phone" placeholder="(XX) XXXXX-XXXX" required #phone="ngModel"
                     pattern="^(\([0-9]{2}\)\s?9[0-9]{4}-[0-9]{4}|\([0-9]{2}\)\s?[0-9]{4}-[0-9]{4})$"
                     [class.is-invalid]="phone.invalid && (phone.dirty || phone.touched || formRegistro.submitted)">
              <div class="invalid-feedback" *ngIf="phone.errors?.['required'] && (phone.dirty || phone.touched || formRegistro.submitted)">
                Telefone é obrigatório.
              </div>
              <div class="invalid-feedback" *ngIf="phone.errors?.['pattern'] && (phone.dirty || phone.touched || formRegistro.submitted)">
                **Telefone inválido**. Formato esperado: (XX) XXXXX-XXXX ou (XX) XXXX-XXXX.
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="userType" class="form-label">Tipo de Usuário<span class="required-star">*</span></label>
              <select class="form-select" id="userType" name="userType"
                      [(ngModel)]="registroData.userType" required #userType="ngModel"
                      [class.is-invalid]="userType.invalid && (userType.dirty || userType.touched || formRegistro.submitted)">
                <option value="" disabled selected>Selecione</option>
                <option *ngFor="let r of roles" [value]="r.id">
                  {{ r.role }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="userType.errors?.['required'] && (userType.dirty || userType.touched || formRegistro.submitted)">
                O tipo de usuário é obrigatório.
              </div>
            </div>
          </div>

          <div class="row g-2">
            <div class="col-md-6 mb-3">
              <label for="bloco" class="form-label">Bloco<span class="required-star">*</span></label>
              <select class="form-select" id="bloco" name="bloco"
                      [(ngModel)]="registroData.bloco"
                      (change)="onBlocoChange()" required #bloco="ngModel"
                      [class.is-invalid]="bloco.invalid && (bloco.dirty || bloco.touched || formRegistro.submitted)">
                <option value="" disabled selected>Selecione o Bloco</option>
                <option *ngFor="let b of blocos" [value]="b">
                  {{ b }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="bloco.errors?.['required'] && (bloco.dirty || bloco.touched || formRegistro.submitted)">
                O bloco é obrigatório.
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="apartment" class="form-label">Apartamento<span class="required-star">*</span></label>
              <select class="form-select" id="apartment" name="apartment"
                      [(ngModel)]="registroData.apartment"
                      (change)="onApartmentChange()" required #apartment="ngModel"
                      [class.is-invalid]="apartment.invalid && (apartment.dirty || apartment.touched || formRegistro.submitted)">
                <option value="" disabled selected>Selecione o Apartamento</option>
                <option *ngFor="let a of apartamentos" [value]="a.id">
                  {{ a.name }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="apartment.errors?.['required'] && (apartment.dirty || apartment.touched || formRegistro.submitted)">
                O apartamento é obrigatório.
              </div>
            </div>
          </div>

          <div class="row g-2">
            <div class="col-md-6 mb-3">
              <label for="password" class="form-label">Senha<span class="required-star">*</span></label>
              <input type="password" class="form-control" id="password" name="password" [(ngModel)]="registroData.password" required #password="ngModel"
                     pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})"
                     [class.is-invalid]="password.invalid && (password.dirty || password.touched || formRegistro.submitted)">
              <div class="invalid-feedback" *ngIf="password.errors?.['required'] && (password.dirty || password.touched || formRegistro.submitted)">
                A senha é obrigatória.
              </div>
              <div class="invalid-feedback" *ngIf="password.errors?.['pattern'] && (password.dirty || password.touched || formRegistro.submitted)">
                **Senha inválida**: Mínimo 1 letra maiúscula, 1 minúscula, 1 número, 8 caracteres.
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="comprovante" class="form-label">Anexar Comprovante<span class="required-star">*</span></label>
              <input type="file" class="form-control" id="comprovante" name="comprovante" (change)="onFileSelected($event)" required #comprovante="ngModel"
                     accept=".pdf, .png, .jpg, .jpeg"
                     [class.is-invalid]="comprovante.invalid && formRegistro.submitted">
              <div class="form-text">Sujeito a aprovação. Use .pdf, .png ou .jpg.</div>
              <div class="invalid-feedback" *ngIf="comprovante.errors?.['required'] && formRegistro.submitted">
                Anexar comprovante é obrigatório.
              </div>
              </div>
          </div>

          <button type="submit" class="btn btn-primary w-100">Registrar</button>

          <div *ngIf="registroMessage" class="alert mt-3" [ngClass]="{'alert-success': isSuccess, 'alert-danger': !isSuccess}">
            {{ registroMessage }}
          </div>
        </form>

        <div class="text-center mt-3">
          Já tem uma conta? <a class="text-decoration-none fw-bold" routerLink="/login">Fazer Login</a>
        </div>
      </div>
    </div>
  </div>
</div>