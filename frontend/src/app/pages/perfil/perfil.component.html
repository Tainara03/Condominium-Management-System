<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <div class="card shadow-lg border-0">
        <div class="card-header text-white text-center py-3 perfil-header">
          <h4 class="mb-0">Meu Perfil e Dados Cadastrais</h4>
        </div>
        <div class="card-body p-4 p-md-5">

          <form (ngSubmit)="salvarPerfil()">
            
            <h5 class="mb-3 text-primary">Informações Pessoais</h5>

            <div class="row mb-4 g-3">
              
              <div class="col-md-6">
                <label for="fullName" class="form-label fw-bold">Nome Completo</label>
                <input type="text" class="form-control" id="fullName" name="fullName" 
                       [(ngModel)]="perfilData.fullName" [readonly]="!modoEdicao" required>
              </div>

              <div class="col-md-6">
                <label for="email" class="form-label fw-bold">E-mail</label>
                <input type="email" class="form-control" id="email" name="email" 
                       [(ngModel)]="perfilData.email" [readonly]="!modoEdicao" required>
              </div>
            </div>

            <div class="row mb-5 g-3">
              
              <div class="col-md-6">
                <label for="phone" class="form-label fw-bold">Telefone</label>
                <input type="tel" class="form-control" id="phone" name="phone" 
                       [(ngModel)]="perfilData.phone" [readonly]="!modoEdicao" required>
              </div>
              
              <div class="col-md-6">
                <label for="userType" class="form-label fw-bold">Tipo de Usuário</label>
                <input type="text" class="form-control" id="userType" name="userType" 
                       [(ngModel)]="perfilData.userTypeDisplay" readonly>
                <div class="form-text">O tipo de usuário só pode ser alterado pela administração.</div>
              </div>
            </div>

            <hr class="mb-5">

            <h5 class="mb-3 text-primary">Dados da(s) Unidade(s)</h5>
            
            <div class="mb-4">
              
              <ul class="list-group mb-3">
                <li *ngFor="let unidade of perfilData.unidades; let i = index" class="list-group-item d-flex justify-content-between align-items-center">
                  Bloco: {{ unidade.bloco }} | Apto: {{ unidade.apartment }}
                  
                  <button *ngIf="modoEdicao && perfilData.unidades.length > 1" type="button" class="btn btn-sm btn-outline-danger" (click)="removerUnidade(i)">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </li>
              </ul>
              
              <div *ngIf="modoEdicao" class="card p-3 bg-light border">
                <h6 class="mb-3">Adicionar Nova Unidade</h6>
                <div class="row g-2 mb-3">
                  <div class="col-md-5">
                    <input type="text" class="form-control" placeholder="Novo Bloco (Ex: D)" 
                           [(ngModel)]="novaUnidadeTemp.bloco" name="newBlock" required>
                  </div>
                  <div class="col-md-5">
                    <input type="text" class="form-control" placeholder="Novo Apartamento (Ex: 401)" 
                           [(ngModel)]="novaUnidadeTemp.apartment" name="newApartment" required>
                  </div>
                  <div class="col-md-2 d-grid">
                    <button type="button" class="btn btn-success" (click)="adicionarUnidade()">
                      <i class="bi bi-plus-lg"></i>
                    </button>
                  </div>
                </div>

                <div class="mt-3">
                  <label for="comprovanteAnexo" class="form-label">Anexar Comprovante (para novas unidades/mudanças)</label>
                  <input class="form-control" type="file" id="comprovanteAnexo" name="novoComprovante" 
                         (change)="onComprovanteSelected($event)">
                  <div class="form-text text-danger fw-bold">Sujeito a aprovação. Necessário para qualquer alteração de unidade.</div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
              
              <button *ngIf="!modoEdicao" type="button" class="btn btn-outline-secondary btn-lg" (click)="alternarModoEdicao()">
                <i class="bi bi-pencil-square me-2"></i> Editar Dados
              </button>

              <ng-container *ngIf="modoEdicao">
                <button type="button" class="btn btn-secondary btn-lg me-3" (click)="cancelarEdicao()">
                  Cancelar
                </button>
                <button type="submit" class="btn btn-marrom btn-lg">
                  <i class="bi bi-save me-2"></i> Salvar Alterações
                </button>
              </ng-container>
            </div>
            
          </form>

        </div>
      </div>

    </div>
  </div>
</div>